<?xml version="1.0" encoding="utf8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Vocco : generator.rb</title>
<meta name="Generator" content="Vim/7.2" />
<meta http-equiv="content-type" content="text/html; charset=utf8" />
<style type="text/css">
<!--
.Special { color: #799d6a; }
.Identifier { color: #c6b6ee; }
.Constant { color: #cf6a4c; }
.rubyIdentifier { color: #c6b6fe; }
.rubyRegexpDelimiter { color: #540063; }
.rubyRegexpSpecial { color: #a40073; }
.rubyControl { color: #7597c6; }
.PreProc { color: #8fbfdc; }
.StringDelimiter { color: #556633; }
.String { color: #99ad6a; }
.Statement { color: #8197bf; }
.rubySymbol { color: #7697d6; }
.Function { color: #fad07a; }
.rubyInstanceVariable { color: #c6b6fe; }
.Type { color: #ffb964; }
body { color: #e8e8d3; background-color: #151515; font-family: monospace; }
.rubyClass { color: #447799; }
-->
</style><style type="text/css">body {
  font-family: "Palatino Linotype", "Book Antiqua", Palatino, FreeSerif, serif;
  font-size: 15px; }

html, body {
  height: 100%; }

body {
  padding: 1em; }

.code {
  font-family: Menlo, Monaco, "DejaVu Sans Mono", Consolas, "Lucida Console", monospace;
  font-size: 16px;
  padding: 1em;
  width: 50%; }

.nav {
  width: 40%;
  position: fixed;
  top: 0;
  left: 55%;
  height: 100%;
  font-size: 15px;
  line-height: 22px;
  color: #252519; }
  .nav .wrapper {
    color: black;
    height: 100%; }
    .nav .wrapper .area {
      background-color: #cccccc;
      padding: 1em 1em 1em 1em;
      border-bottom: 1px dashed #bbbbbb;
      border-top: 1px dashed #666666; }
      .nav .wrapper .area .autohide {
        opacity: 0;
        height: 0px;
        -webkit-transition: all 0.2s linear;
        overflow: auto; }
      .nav .wrapper .area:hover .autohide {
        height: 150px;
        opacity: 1; }
    .nav .wrapper .notes {
      max-height: 40%;
      overflow: auto; }

table th {
  text-align: right; }

</style>
</head>
<body><div class="code">
<br />
<br />
<span class="rubyClass">class</span>&nbsp;<span class="Type">Vocco</span>::<span class="Type">Generator</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">require</span>&nbsp;<span class="StringDelimiter">'</span><span class="String">vocco/generator/css</span><span class="StringDelimiter">'</span><br />
<br />
&nbsp;&nbsp;<span class="Statement">attr_reader</span>&nbsp;<span class="rubySymbol">:globs</span>, <span class="rubySymbol">:notes</span>, <span class="rubySymbol">:out</span>, <span class="rubySymbol">:name</span>, <span class="rubySymbol">:site</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">initialize</span>(opts)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@globs</span>&nbsp;&nbsp;= opts[<span class="rubySymbol">:files</span>].map {|<span class="rubyIdentifier">path</span>|&nbsp;path.sub(<span class="rubyRegexpDelimiter">/</span><span class="rubyRegexpSpecial">\/</span><span class="rubyRegexpSpecial">$</span><span class="rubyRegexpDelimiter">/</span>, <span class="StringDelimiter">''</span>) }<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@out</span>&nbsp;&nbsp;&nbsp;&nbsp;= opts[<span class="rubySymbol">:out</span>]<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@notes</span>&nbsp;&nbsp;= opts[<span class="rubySymbol">:notes</span>]<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@name</span>&nbsp;&nbsp; = opts[<span class="rubySymbol">:name</span>].capitalize<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@site</span>&nbsp;&nbsp; = opts[<span class="rubySymbol">:site</span>]<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@vim</span>&nbsp;&nbsp;&nbsp;&nbsp;= opts[<span class="rubySymbol">:vim</span>]<br />
&nbsp;&nbsp;&nbsp;&nbsp;validate_out<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">run</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;run_vim; postprocess<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
&nbsp;&nbsp;<span class="PreProc">alias</span>&nbsp;<span class="rubySymbol">:run!</span>&nbsp;<span class="rubySymbol">:run</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">trimmed_globs</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@trimmed_globs</span>&nbsp;||= <span class="rubyInstanceVariable">@globs</span>.map <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">glob</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glob.gsub(<span class="rubyRegexpDelimiter">/</span><span class="rubyRegexpSpecial">(</span><span class="rubyRegexpSpecial">^</span><span class="rubyRegexpSpecial">\.\/</span><span class="rubyRegexpSpecial">)|(</span><span class="rubyRegexpSpecial">\/</span><span class="rubyRegexpSpecial">$</span><span class="rubyRegexpSpecial">)</span><span class="rubyRegexpDelimiter">/</span>, <span class="StringDelimiter">''</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">scopes</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@scopes</span>&nbsp;||= trimmed_globs.map <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">glob</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokens = glob.split(<span class="StringDelimiter">'</span><span class="String">*</span><span class="StringDelimiter">'</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokens.size &gt; <span class="Constant">1</span>&nbsp;? tokens.first : <span class="Constant">nil</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span>.compact<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">glob_regex</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@glob_regex</span>&nbsp;||= <span class="rubyControl">begin</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str = scopes.map <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">scope</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">Regexp</span>::escape(scope)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span>.join(<span class="StringDelimiter">'</span><span class="String">|</span><span class="StringDelimiter">'</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyRegexpDelimiter">/</span><span class="rubyRegexpSpecial">^</span><span class="rubyRegexpSpecial">(</span><span class="rubyRegexpSpecial">\.\/</span><span class="rubyRegexpSpecial">)</span><span class="rubyRegexpSpecial">?</span><span class="rubyRegexpSpecial">(</span><span class="Identifier">#{</span>str<span class="Identifier">}</span><span class="rubyRegexpSpecial">)(</span><span class="rubyRegexpSpecial">\/</span><span class="rubyRegexpSpecial">)</span><span class="rubyRegexpSpecial">?</span><span class="rubyRegexpDelimiter">/</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">doc_regex</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@doc_regex</span>&nbsp;||= <span class="rubyControl">begin</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str = <span class="Type">Regexp</span>::escape(<span class="rubyInstanceVariable">@out</span>) + <span class="StringDelimiter">'</span><span class="String">/</span><span class="StringDelimiter">'</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyRegexpDelimiter">/</span><span class="rubyRegexpSpecial">^</span><span class="Identifier">#{</span>str<span class="Identifier">}</span><span class="rubyRegexpDelimiter">/</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">files</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@files</span>&nbsp;||= <span class="rubyInstanceVariable">@globs</span>.map <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">glob</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">Dir</span>[glob]<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span>.flatten.uniq.map <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">path</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">SourceFile</span>.new(path, <span class="Constant">self</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="Statement">private</span><br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">validate_out</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">unless</span>&nbsp;<span class="Type">File</span>.directory?(<span class="rubyInstanceVariable">@out</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">raise</span>&nbsp;<span class="StringDelimiter">&quot;</span><span class="Identifier">#{</span><span class="rubyInstanceVariable">@out</span><span class="Identifier">}</span><span class="String">&nbsp;is not a valid directory.</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">run_vim</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script = <span class="Type">Tempfile</span>.new(<span class="StringDelimiter">'</span><span class="String">vimdocco</span><span class="StringDelimiter">'</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.write(vimscript)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.close<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system <span class="StringDelimiter">&quot;</span><span class="Identifier">#{</span>vim_command<span class="Identifier">}</span><span class="String">&nbsp;-f -S </span><span class="Identifier">#{</span>script.path<span class="Identifier">}</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">vim_command</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@vim_command</span>&nbsp;||= <span class="rubyInstanceVariable">@vim</span>.detect <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">c</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="StringDelimiter">`</span><span class="String">which </span><span class="Identifier">#{</span>c<span class="Identifier">}</span><span class="StringDelimiter">`</span>.chomp.strip != <span class="StringDelimiter">''</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span>&nbsp;|| <span class="rubyControl">abort</span>(<span class="StringDelimiter">&quot;</span><span class="String">You must install one of </span><span class="Identifier">#{</span><span class="rubyInstanceVariable">@vim</span>.inspect<span class="Identifier">}</span><span class="String">.</span><span class="StringDelimiter">&quot;</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">vimscript</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@vimscript</span>&nbsp;||= <span class="rubyControl">begin</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s = <span class="StringDelimiter">&quot;</span><span class="String">let html_no_pre = 1</span><span class="Special">\n</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.each <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">file</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s &lt;&lt; <span class="StringDelimiter">&quot;</span><span class="String">view! </span><span class="Identifier">#{</span>file.file<span class="Identifier">}</span><span class="Special">\n</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s &lt;&lt; <span class="StringDelimiter">&quot;</span><span class="String">TOhtml</span><span class="Special">\n</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s &lt;&lt; <span class="StringDelimiter">&quot;</span><span class="String">w! </span><span class="Identifier">#{</span>file.doc_path<span class="Identifier">}</span><span class="Special">\n</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s &lt;&lt; <span class="StringDelimiter">&quot;</span><span class="String">:qall!</span><span class="Special">\n</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">postprocess</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hpricotify_docs <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">doc</span>, <span class="rubyIdentifier">file</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.at(<span class="StringDelimiter">'</span><span class="String">style</span><span class="StringDelimiter">'</span>).after(<span class="StringDelimiter">'</span><span class="String">&lt;style type=&quot;text/css&quot;&gt;</span><span class="StringDelimiter">'</span>&nbsp;+ <span class="Type">CSS</span>&nbsp;+ <span class="StringDelimiter">'</span><span class="String">&lt;/style&gt;</span><span class="StringDelimiter">'</span>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.at(<span class="StringDelimiter">'</span><span class="String">title</span><span class="StringDelimiter">'</span>).inner_html = name + <span class="StringDelimiter">'</span><span class="String">&nbsp;: </span><span class="StringDelimiter">'</span>&nbsp;+ file.basename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inner = doc.at(<span class="StringDelimiter">'</span><span class="String">body</span><span class="StringDelimiter">'</span>).inner_html<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.at(<span class="StringDelimiter">'</span><span class="String">body</span><span class="StringDelimiter">'</span>).swap <span class="StringDelimiter">&quot;</span><span class="String">&lt;body&gt;&lt;div class='code'&gt;</span><span class="Identifier">#{</span>inner<span class="Identifier">}</span><span class="String">&lt;/div&gt;&lt;/body&gt;</span><span class="StringDelimiter">&quot;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.at(<span class="StringDelimiter">'</span><span class="String">.code</span><span class="StringDelimiter">'</span>).after file.render_template<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">hpricotify_docs</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.each <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">file</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc = <span class="Type">File</span>.open(file.doc_path) {|<span class="rubyIdentifier">f</span>|&nbsp;Hpricot(f) }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">yield</span>(doc, file)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">File</span>.open(file.doc_path, <span class="StringDelimiter">'</span><span class="String">w</span><span class="StringDelimiter">'</span>)&nbsp;&nbsp;{|<span class="rubyIdentifier">f</span>|&nbsp;f.write(doc.to_html) }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">end</span><br />
<span class="rubyClass">end</span><br />
<br />
<span class="rubyClass">class</span>&nbsp;<span class="Type">Vocco</span>::<span class="Type">Generator</span>::<span class="Type">SourceFile</span><br />
&nbsp;&nbsp;<span class="PreProc">require</span>&nbsp;<span class="StringDelimiter">'</span><span class="String">vocco/generator/source_file/html_template</span><span class="StringDelimiter">'</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">initialize</span>(file, generator)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@file</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = file<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@gen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= generator<br />
&nbsp;&nbsp;&nbsp;&nbsp;puts short_path.inspect<br />
&nbsp;&nbsp;&nbsp;&nbsp;puts short_dirname.inspect<br />
&nbsp;&nbsp;&nbsp;&nbsp;puts dirname.inspect<br />
&nbsp;&nbsp;&nbsp;&nbsp;puts basename.inspect<br />
&nbsp;&nbsp;&nbsp;&nbsp;puts doc_path.inspect<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="Statement">attr_reader</span>&nbsp;<span class="rubySymbol">:file</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">short_path</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@short_path</span>&nbsp;||= <span class="rubyInstanceVariable">@file</span>.sub(<span class="rubyInstanceVariable">@gen</span>.glob_regex, <span class="StringDelimiter">''</span>)<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">short_dirname</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">File</span>.dirname(short_path).sub(<span class="rubyRegexpDelimiter">/</span><span class="rubyRegexpSpecial">^</span><span class="rubyRegexpSpecial">\.\/</span><span class="rubyRegexpDelimiter">/</span>, <span class="StringDelimiter">''</span>)<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">dirname</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">File</span>.dirname(<span class="rubyInstanceVariable">@file</span>)<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">basename</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">File</span>.basename(<span class="rubyInstanceVariable">@file</span>)<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">doc_prefix</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;short_dirname == <span class="StringDelimiter">'</span><span class="String">.</span><span class="StringDelimiter">'</span>&nbsp;? <span class="StringDelimiter">''</span>&nbsp;: short_dirname.gsub(<span class="StringDelimiter">'</span><span class="String">/</span><span class="StringDelimiter">'</span>, <span class="StringDelimiter">'</span><span class="String">-</span><span class="StringDelimiter">'</span>) + <span class="StringDelimiter">'</span><span class="String">-</span><span class="StringDelimiter">'</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">doc_path</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">File</span>.join(<span class="rubyInstanceVariable">@gen</span>.out, doc_prefix + basename + <span class="StringDelimiter">'</span><span class="String">.html</span><span class="StringDelimiter">'</span>)<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">doc_link</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="StringDelimiter">'</span><span class="String">./</span><span class="StringDelimiter">'</span>&nbsp;+ doc_path.sub(<span class="rubyInstanceVariable">@gen</span>.doc_regex, <span class="StringDelimiter">''</span>)<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">notes</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;rendered = render_notes<br />
&nbsp;&nbsp;&nbsp;&nbsp;rendered.any? ?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rendered.join(<span class="StringDelimiter">&quot;</span><span class="Special">\n</span><span class="StringDelimiter">&quot;</span>) : <span class="Constant">nil</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">render_notes</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">Dir</span>[note_glob].map <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">path</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">Tilt</span>.new(path).render<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="PreProc">def</span>&nbsp;<span class="Function">note_glob</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;dirs = [dirname]<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyInstanceVariable">@gen</span>.notes.each <span class="rubyControl">do</span>&nbsp;|<span class="rubyIdentifier">dir</span>|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dirs &lt;&lt; <span class="Type">File</span>.join(dir, short_dirname)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="rubyControl">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;ext&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span class="StringDelimiter">'</span><span class="String">.{textile,md,mkd,markdowb,rdoc}</span><span class="StringDelimiter">'</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;dir_glob&nbsp;&nbsp;= <span class="StringDelimiter">'</span><span class="String">{</span><span class="StringDelimiter">'</span>&nbsp;+ dirs.join(<span class="StringDelimiter">'</span><span class="String">,</span><span class="StringDelimiter">'</span>) + <span class="StringDelimiter">'</span><span class="String">}/</span><span class="StringDelimiter">'</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;dir_glob + basename + ext<br />
&nbsp;&nbsp;<span class="PreProc">end</span><br />
<br />
&nbsp;&nbsp;<span class="Statement">class_eval</span>&nbsp;&lt;&lt;-<span class="StringDelimiter">EOF</span>, <span class="StringDelimiter">'</span><span class="String">(template)</span><span class="StringDelimiter">'</span><br />
<span class="String">&nbsp;&nbsp;&nbsp;&nbsp;def render_template</span><br />
<span class="String">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Identifier">#{</span><span class="Type">HTML_TEMPLATE</span><span class="Identifier">}</span><br />
<span class="String">&nbsp;&nbsp;&nbsp;&nbsp;end</span><br />
<span class="String">&nbsp;&nbsp;</span><span class="StringDelimiter">EOF</span><br />
<span class="rubyClass">end</span><br />
</div><div class="nav"><div class="wrapper"><div class="area"><h3><strong><a href="http://github.com/jbe/vocco">Vocco</a></strong><span> : </span><span>generator.rb</span></h3><p class="autohide"><a href="./README.html">README</a><br />vocco/<a href="./vocco-generator.rb.html">generator.rb</a><br />vocco/generator/<a href="./vocco-generator-css.rb.html">css.rb</a><br />vocco/generator/source_file/<a href="./vocco-generator-source_file-html_template.rb.html">html_template.rb</a><br />vocco/<a href="./vocco-cli.rb.html">cli.rb</a><br /><a href="./vocco.rb.html">vocco.rb</a><br /></p></div><div class="area"><table><tr><th>Generated:</th><td>2011-03-02 13:34:08 +0100</td></tr></table></div></div></div></body>
</html>
